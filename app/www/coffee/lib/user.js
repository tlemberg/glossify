// Generated by CoffeeScript 1.10.0
(function() {
  define(['api'], function(api) {
    var _updateUserProfile;
    _updateUserProfile = function(userProfile, lang, tileId, cards, handler) {
      var card, existingCards, i, j, len, len1, progressMap, syncRequired;
      progressMap = {};
      for (i = 0, len = cards.length; i < len; i++) {
        card = cards[i];
        progressMap[card['phrase_id']] = card['progress'];
      }
      existingCards = userProfile['langs'][lang][_tileId];
      syncRequired = false;
      for (j = 0, len1 = existingCards.length; j < len1; j++) {
        card = existingCards[j];
        syncRequired || (syncRequired = card['progress'] !== progressMap[card['phrase_id']]);
        card['progress'] = progressMap[card['phrase_id']];
      }
      if (syncRequired) {
        return api.syncUserProfile(userProfile, handler);
      } else {
        return handler();
      }
    };
    return {
      updateUserProfile: function(userProfile, lang, tileId, cards, handler) {
        return _updateUserProfile(email, cards, handler);
      }
    };
  });

}).call(this);
