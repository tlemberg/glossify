// Generated by CoffeeScript 1.9.1
(function() {
  define(['jquery', 'hbs!../../hbs/src/app', 'hbs!../../hbs/src/alert', 'hbs!../../hbs/src/modal', 'pageview', 'utils', 'constants', 'storage'], function($, appTemplate, alertTemplate, modalTemplate, pageview, utils, constants, storage) {
    var _hideAlert, _hideBackBtn, _hideModal, _initPages, _loadPage, _modalTimeout, _refreshPage, _showAlert, _showBackBtn, _showModal;
    _modalTimeout = void 0;
    _initPages = function() {
      $("body").html(appTemplate({
        pages: constants.pages
      }));
      _hideAlert();
      return _hideModal();
    };
    _loadPage = function(page) {
      var template;
      template = constants.templateMap[page];
      _hideAlert();
      _hideBackBtn();
      constants.pageActionMap[page]['load'](template);
      storage.setPage(page);
      return pageview.formatPageDimensions(page);
    };
    _refreshPage = function() {
      var page;
      page = storage.getPage();
      constants.pageActionMap[page]['refresh']();
      return pageview.formatPageDimensions(page, false);
    };
    _showAlert = function(message) {
      $(".alert-div").finish();
      $(".alert-div").html(alertTemplate({
        message: message
      }));
      $(".alert-div").css("visibility", "visible");
      console.log(pageview.getAlertHeight());
      console.log(utils.withUnit(-1 * pageview.getAlertHeight(), 'px'));
      $(".alert-div").css("margin-top", utils.withUnit(-1 * pageview.getAlertHeight(), 'px'));
      $(".alert-div").show();
      return $(".alert-div").animate({
        "margin-top": "0px"
      }, 500, function() {
        console.log("create");
        return $(".alert-div .alert-btn").click(function(event) {
          console.log("click it");
          return _hideAlert();
        });
      });
    };
    _showBackBtn = function(text, clickEvent) {
      $(".header .back-btn").html(text);
      $(".header .back-btn").css("visibility", "visible");
      $(".header .back-btn").off('click');
      return $(".header .back-btn").click(clickEvent);
    };
    _hideBackBtn = function() {
      return $(".header .back-btn").css("visibility", "hidden");
    };
    _hideAlert = function() {
      $(".alert-div").css("margin-top", "0px");
      return $(".alert-div").animate({
        "margin-top": utils.withUnit(-1 * pageview.getAlertHeight(), 'px')
      }, 500, function() {
        return $(".alert-div").hide();
      });
    };
    _showModal = function(html, type, delay) {
      var templateArgs;
      templateArgs = {
        html: html,
        isAjax: type === 'ajax',
        isAlert: type === 'alert'
      };
      $(".modal-div").html(modalTemplate(templateArgs));
      $(".modal-div").css("visibility", "visible");
      $(".modal-div .btn").click(function(event) {
        return _hideModal();
      });
      if (_modalTimeout != null) {
        clearTimeout(_modalTimeout);
      }
      return _modalTimeout = setTimeout((function() {
        return $(".modal-div").fadeIn(250);
      }), delay);
    };
    _hideModal = function() {
      if (_modalTimeout != null) {
        clearTimeout(_modalTimeout);
      }
      return $(".modal-div").fadeOut(250);
    };
    return {
      initPages: function() {
        return _initPages();
      },
      loadPage: function(page) {
        return _loadPage(page);
      },
      refreshPage: function() {
        return _refreshPage();
      },
      showAlert: function(message) {
        return _showAlert(message);
      },
      hideAlert: function() {
        return _hideAlert();
      },
      showModal: function(html, type, delay) {
        return _showModal(html, type, delay);
      },
      hideModal: function() {
        return _hideModal();
      },
      showBackBtn: function(text, clickEvent) {
        return _showBackBtn(text, clickEvent);
      }
    };
  });

}).call(this);
